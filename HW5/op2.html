<!DOCTYPE html>
<html>
<style>
    #info {
        position: absolute;
        top: 0px;
        width: 100%;
        padding: 10px;
        text-align: center;
        color: #ffff00
    }

    body {
        overflow: hidden;
    }
</style>

<head>
    <title></title>
    <div id="info">HW4
        <br></div>
</head>

<body>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r70/three.min.js"></script>
    <script src="https://dl.dropboxusercontent.com/u/3587259/Code/Threejs/OrbitControls.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.5.1/dat.gui.min.js"></script>


    <script>
        var scene, renderer, camera;
        var controls;
        var torso, lowerArm, upperArm;
        var  lowerArmL, upperArmL;
        var clock = new THREE.Clock();

        var gcontrols;

        var dt = 0;
/*

    "left": {
      "0": {
        "shoulderRZ": 0.01,
        "shoulderRY": 0.02547081469150081,
        "shoulderRX": 0.6302465924461575,
        "elbowX": -0.8540214337737995,
        "torsoY": 0.1
        "shoulderLX": -0.8480941976207808
        "shoulderLZ": 0.01,
        "shoulderLY": -3.132802691360594,

    "right": {
      "0": {
        "shoulderRZ": 0.01,
        "shoulderRY": 0.02547081469150081,
        "shoulderRX": -0.6465022717025617,
        "elbowX": -0.9190510872958058,
        "torsoY": 0.1
        "shoulderLZ": 0.01,
        "shoulderLY": -3.132802691360594,
        "shoulderLX": 0.15986543197031367,

*/
        var keys1 = [
            [0, [0.01, 0.021, -.65, -.98, 0,0.01,-3.1,0.15]],
            [0.5, [0.01, 0.021, -.65, -.98, 0,0.01,-3.1,0.15]],
            [0.6, [0.01, 0.021, .65, -.98, 0,0.01,-3.1,-.84]],
            [0.9, [0.01, 0.021, .65, -.98, 0,0.01,-3.1,-.84]],
            [1, [0.01, 0.021, .65, -.98, 0,0.01,-3.1,-.84]],

        ];
        var T1 = 4;
        var clock1 = new THREE.Clock();
        var ts = clock.getElapsedTime();
        var intKey1 = [];

      /////////////////////////////////////////////////////

        init();
        animate();


        function init() {
            var width = window.innerWidth;
            var height = window.innerHeight;

            renderer = new THREE.WebGLRenderer({
                antialias: true
            });
            renderer.setSize(width, height);
            renderer.setClearColor(0x888888);

            document.body.appendChild(renderer.domElement);

            scene = new THREE.Scene();

            camera = new THREE.PerspectiveCamera(40, width / height, 0.1, 10000);
            camera.position.y = 160;
            camera.position.z = 400;
            camera.lookAt(new THREE.Vector3(0, 0, 0));
            scene.add(camera);

            controls = new THREE.OrbitControls(camera, renderer.domElement);

            var boxGeometry = new THREE.BoxGeometry(50, 100, 30);
            torso = new THREE.Object3D();
            var bodyMesh = new THREE.Mesh(boxGeometry, new THREE.MeshNormalMaterial());
            bodyMesh.position.set(0, 50, 0);
            torso.add(bodyMesh);
            scene.add(torso);
            //torso.position.set(0, 0, -35);

            var boxGeometry = new THREE.BoxGeometry(10, 40, 10);
            var arm = new THREE.Mesh(boxGeometry, new THREE.MeshNormalMaterial());
            upperArm = new THREE.Object3D();
            upperArm.add(arm);
            arm.position.set(-5, -20, 0);
            torso.add(upperArm);
            upperArm.position.set(-25, 100, 0);


            var geometry = new THREE.CylinderGeometry(0.5, 0.5,50, 50);
            var material = new THREE.MeshBasicMaterial({
                color: 0xffff00});
            var stick = new THREE.Mesh(geometry, material);

            boxGeometry = new THREE.BoxGeometry(10, 40, 10);
            arm2 = new THREE.Mesh(boxGeometry, new THREE.MeshNormalMaterial());
            lowerArm = new THREE.Object3D();
            lowerArm.position.set(0, -40, 0);
            upperArm.add(lowerArm);
            lowerArm.add(arm2);
            arm2.add(stick);
            arm2.position.set(-5, -20, 0);
            stick.position.set(0,-20,0);


            //////////////////////////////////
            var boxGeometry = new THREE.BoxGeometry(10, 40, 10);
            var armL = new THREE.Mesh(boxGeometry, new THREE.MeshNormalMaterial());
            upperArmL = new THREE.Object3D();
            upperArmL.add(armL);
            armL.position.set(-5, -20, 0);
            torso.add(upperArmL);
            upperArmL.position.set(25, 100, 0);

            var geometry = new THREE.CylinderGeometry(0.5, 0.5,50, 50);
            var material = new THREE.MeshBasicMaterial({
                color: 0xffff00});
            var stick = new THREE.Mesh(geometry, material);

            boxGeometry = new THREE.BoxGeometry(10, 40, 10);
            armL2 = new THREE.Mesh(boxGeometry, new THREE.MeshNormalMaterial());
            lowerArmL = new THREE.Object3D();
            lowerArmL.position.set(0, -40, 0);
            upperArmL.add(lowerArmL);
            lowerArmL.add(armL2);
            armL2.add(stick);
            armL2.position.set(-5, -20, 0);
            stick.position.set(0,-20,0);

            ////////////////////////////////
            var gridXZ = new THREE.GridHelper(500, 10);
            gridXZ.setColors(new THREE.Color(0xff0000), new THREE.Color(0xffffff));
            scene.add(gridXZ);

            window.addEventListener('resize', onWindowResize, false);
            ///////////////////////////////////////////////////
            gcontrols = {
                shoulderRZ: 0.01,
                shoulderRY: 0.1,
                shoulderRX: 0.1,
                shoulderLZ: 0.01,
                shoulderLY: 0.09,
                shoulderLX: 0.1,
                elbowX: 0.1,
                torsoY: 0.1,

            };

            gui = new dat.GUI();
            gui.remember(gcontrols);

            gui.domElement.id = 'gui';
            gui.add(gcontrols, 'shoulderRZ', -3.14, 3);
            gui.add(gcontrols, 'shoulderRY', -3.2, 3);
            gui.add(gcontrols, 'shoulderRX', -3.2, 3);
            gui.add(gcontrols, 'shoulderLZ', -3.14, 3);
            gui.add(gcontrols, 'shoulderLY', -3.2, 3);
            gui.add(gcontrols, 'shoulderLX', -3.2, 3);
            gui.add(gcontrols, 'elbowX', -3, 3);
            gui.add(gcontrols, 'torsoY', -3, 3);

        }


        function animate() {
            requestAnimationFrame(animate);
            update();
            render();
        }

        function update() {
            controls.update();
           keyframe(clock.getElapsedTime());
        }

        function onWindowResize() {
            var width = window.innerWidth,
                height = window.innerHeight;
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
            renderer.setSize(width, height);
        }

        function keyframe(t) {
            var s = ((t - ts) % T1) / T1;
            console.log("key1T"+"="+s);

            for (var i = 0; i < keys1.length; i++) {
                if (keys1[i][0] > s) break;
            }

            // take i-1
            var ii = i - 1;
            var a = (s - keys1[ii][0]) / (keys1[ii + 1][0] - keys1[ii][0]);
            intKey1 = []
            for (var j = 0; j < 7; j++) {
                intKey1.push(keys1[ii][1][j] * (1 - a) + keys1[ii + 1][1][j] * a);
            }
            //console.log(intKey1);
        }

        function render() {
            upperArm.rotation.order = 'ZXY';

            upperArm.rotation.z = gcontrols.shoulderRZ;
            upperArm.rotation.y = gcontrols.shoulderRY;
            upperArm.rotation.x = gcontrols.shoulderRX;

            lowerArm.rotation.x = gcontrols.elbowX;
            torso.rotation.y = gcontrols.torsoY;


//////////////////////////////////////////////////

            upperArmL.rotation.order = 'ZXY';

            upperArmL.rotation.z = -gcontrols.shoulderLZ;
            upperArmL.rotation.y = gcontrols.shoulderLY;
            upperArmL.rotation.x = gcontrols.shoulderLX;

            lowerArmL.rotation.x = -gcontrols.elbowX;
            torso.rotation.y = gcontrols.torsoY;

            upperArm.rotation.z = intKey1[0];
            upperArm.rotation.y = intKey1[1];
            upperArm.rotation.x = intKey1[2];

            lowerArm.rotation.x = intKey1[3];
            torso.rotation.y = intKey1[4];
            upperArmL.rotation.z = intKey1[5];
            upperArmL.rotation.y = intKey1[6];
            upperArmL.rotation.x = intKey1[7];
            lowerArmL.rotation.x = -intKey1[3];

            renderer.render(scene, camera);
        }
    </script>
</body>

</html>
